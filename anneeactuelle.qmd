---
execute:
    echo: false
---
```{python}
import pandas as pd
import matplotlib.pyplot as plt
from matplotlib.backends.backend_tkagg import FigureCanvasTkAgg
import tkinter as tk
from tkinter import ttk

# Charger les données
bdd1 = pd.read_csv("bases_de_donnees/Mesure_mensuelle_annee.csv")
bdd1['valeur'].fillna(0, inplace=True)
bdd2 = pd.read_csv("bases_de_donnees/Mesure_5dernieresannees.csv")
bdd2['valeur'].fillna(0, inplace=True)

class PollutionApp:
    def __init__(self, root):
        self.root = root
        self.root.title("Évolution de la pollution en Occitanie")

        # Frame principale
        self.main_frame = ttk.Frame(self.root, padding="10")
        self.main_frame.grid(row=0, column=0, sticky=(tk.W, tk.E, tk.N, tk.S))

        # Options de sélection
        self.departement_label = ttk.Label(self.main_frame, text="Département:")
        self.departement_label.grid(row=0, column=0, sticky=tk.W)
        self.departement_var = tk.StringVar()
        self.departement_dropdown = ttk.Combobox(self.main_frame, textvariable=self.departement_var, values=[
            'HAUTE-GARONNE', 'GERS', 'TARN', 'HAUTES-PYRENEES', 'TARN-ET-GARONNE', 'HERAULT', 'PYRENEES-ORIENTALES',
            'AVEYRON', 'ARIEGE', 'GARD', 'LOZERE'
        ])
        self.departement_dropdown.grid(row=0, column=1, sticky=tk.W)
        self.departement_dropdown.set('HAUTE-GARONNE')

        self.pollutant_label = ttk.Label(self.main_frame, text="Polluant:")
        self.pollutant_label.grid(row=1, column=0, sticky=tk.W)
        self.pollutant_var = tk.StringVar()
        self.pollutant_dropdown = ttk.Combobox(self.main_frame, textvariable=self.pollutant_var, values=['NO', 'NO2', 'NOX', 'O3', 'PM10'])
        self.pollutant_dropdown.grid(row=1, column=1, sticky=tk.W)
        self.pollutant_dropdown.set('NO')

        self.periode_label = ttk.Label(self.main_frame, text="Période:")
        self.periode_label.grid(row=2, column=0, sticky=tk.W)
        self.periode_var = tk.StringVar()
        self.periode_dropdown = ttk.Combobox(self.main_frame, textvariable=self.periode_var, values=['5ans', 'annee_actuelle'])
        self.periode_dropdown.grid(row=2, column=1, sticky=tk.W)
        self.periode_dropdown.set('5ans')

        self.plot_button = ttk.Button(self.main_frame, text="Afficher le graphique", command=self.plot_graph)
        self.plot_button.grid(row=3, column=0, columnspan=2, pady=10)

        # Initialiser la figure
        self.fig, self.ax = plt.subplots()
        self.canvas = FigureCanvasTkAgg(self.fig, master=self.main_frame)
        self.canvas.get_tk_widget().grid(row=4, column=0, columnspan=2, sticky=(tk.W, tk.E, tk.N, tk.S))

    def plot_graph(self):
        selected_departement = self.departement_var.get()
        selected_pollutant = self.pollutant_var.get()
        selected_periode = self.periode_var.get()

        # Filtrer les données en fonction de la sélection
        if selected_periode == '5ans':
            bdd = bdd2
        else:
            bdd = bdd1

        filtered_data = bdd[(bdd['nom_dept'] == selected_departement) & (bdd['nom_poll'] == selected_pollutant)]
        filtered_data = filtered_data.sort_values(by='date_debut')

        # Effacer le graphique existant
        self.ax.clear()

        # Tracer le nouveau graphique
        for nom_station in filtered_data['nom_station'].unique():
            trace_data = filtered_data[filtered_data['nom_station'] == nom_station]
            self.ax.plot(trace_data['date_debut'], trace_data['valeur'], marker='o', label=nom_station)

        # Ajuster le style du graphique
        self.ax.set_title(f'Évolution de la pollution pour {selected_pollutant} en {selected_departement}')
        self.ax.set_xlabel('Année')
        self.ax.set_ylabel(f'Valeur {selected_pollutant} ug.m-3')
        self.ax.legend()

        # Mettre à jour le canvas
        self.canvas.draw()

if __name__ == "__main__":
    root = tk.Tk()
    app = PollutionApp(root)
    root.mainloop()
```

Le graphique précédent nous permet d'observer la variation de quantité de chaque polluant en moyenne par mois durant l'année en cours dans chaque département de l'Occitanie. 
Certains département proposent de nombreuses données comme la Haute Garonne. Cependant d'autres départements comme le Lot ou l'Aude n'en proposent pas du tout, donc on ne peut pas traiter ces derniers. 
On a choisit d'afficher quand même les autres départements contenant peu de données cependant les graphiques sont peu instructifs. 
Les valeurs nulles dans les graphiques correspondent à un manque de données.